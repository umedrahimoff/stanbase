# Архитектура

## Общая структура

Stanbase построен на архитектуре MVC (Model-View-Controller) с использованием FastAPI и SQLAlchemy.

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   Backend       │    │   Database      │
│   (Jinja2)      │◄──►│   (FastAPI)     │◄──►│   (PostgreSQL)  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## Компоненты

### 🎯 Контроллеры (main.py)

**Основные роуты:**
- `/` - главная страница
- `/companies` - каталог компаний
- `/investors` - каталог инвесторов
- `/jobs` - вакансии
- `/news` - новости
- `/events` - события

**Админ-панель:**
- `/admin/*` - CRUD операции для всех сущностей
- Аутентификация и авторизация
- Управление контентом

**API эндпоинты:**
- `/run-migration` - выполнение миграций
- `/import-data` - импорт данных
- `/test-db` - тестирование БД

### 🗄️ Модели (models.py)

**Основные сущности:**
- `Company` - компании/стартапы
- `Investor` - инвесторы и фонды
- `Deal` - инвестиционные сделки
- `Job` - вакансии
- `News` - новости
- `Event` - события
- `Person` - люди (команды)

**Справочники:**
- `Country` - страны
- `City` - города
- `Category` - категории
- `Currency` - валюты
- `CompanyStage` - стадии компаний

**Связующие таблицы:**
- `company_person` - команды компаний
- `investor_company` - портфели инвесторов
- `portfolio_entry` - записи портфелей

### 🎨 Представления (templates/)

**Структура шаблонов:**
```
templates/
├── layout.html              # Базовый шаблон
├── index.html               # Главная страница
├── 404.html                 # Страница ошибки
├── admin/                   # Админ-панель
│   ├── layout.html
│   ├── dashboard.html
│   ├── companies/
│   ├── investors/
│   └── ...
├── public/                  # Публичные страницы
│   ├── companies/
│   ├── investors/
│   ├── jobs/
│   └── ...
├── auth/                    # Аутентификация
└── dashboard/               # Личные кабинеты
```

### 🗃️ База данных (db.py)

**Конфигурация:**
- SQLite для разработки
- PostgreSQL для продакшена
- SQLAlchemy ORM
- Миграции через psycopg2

**Схема:**
- 15+ таблиц
- Связи many-to-many
- Индексы для поиска
- Ограничения целостности

## Потоки данных

### 1. Публичные страницы
```
User Request → FastAPI Route → SQLAlchemy Query → Database → Jinja2 Template → HTML Response
```

### 2. Админ-панель
```
Admin Request → Auth Check → CRUD Operation → Database → Redirect/Response
```

### 3. Поиск и фильтрация
```
Search Request → Query Builder → Database → Pagination → Template Rendering
```

## Безопасность

- **Аутентификация:** сессии с проверкой ролей
- **Авторизация:** роли admin/user/startuper/investor
- **Валидация:** проверка входных данных
- **SQL Injection:** защита через ORM
- **XSS:** экранирование в шаблонах

## Производительность

- **Кэширование:** статические файлы
- **Оптимизация запросов:** joinedload для связей
- **Пагинация:** ограничение результатов
- **Индексы:** для поисковых полей
- **CDN:** для статических ресурсов

## Масштабируемость

- **Горизонтальное масштабирование:** готовность к балансировщику
- **Вертикальное масштабирование:** оптимизация запросов
- **Микросервисы:** возможность разделения на модули
- **API-first:** готовность к мобильным приложениям 