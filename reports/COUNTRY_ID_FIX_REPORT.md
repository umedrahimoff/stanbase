# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–µ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã –≤–º–µ—Å—Ç–æ ID

## –î–∞—Ç–∞: 29 –∏—é–ª—è 2024

## –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞:
```
ValueError: invalid literal for int() with base 10: '–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω'
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í —Ñ–æ—Ä–º–µ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã (`'–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω'`), –∞ –∫–æ–¥ –ø—ã—Ç–∞–ª—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ `int()`.

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü—Ä–æ–±–ª–µ–º–∞ –≤ —à–∞–±–ª–æ–Ω–µ —Ñ–æ—Ä–º—ã

–í —Ñ–∞–π–ª–µ `templates/admin/companies/form.html` –≤ —Å—Ç—Ä–æ–∫–∞—Ö 47-49:
```html
<!-- –ë—ã–ª–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û): -->
<option value="{{ c.name }}" {% if company and company.country == c.name %}selected{% endif %}>{{ c.name }}</option>
```

### 2. –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

–í —Ñ–∞–π–ª–µ `main.py` –≤ —Å—Ç—Ä–æ–∫–µ 2138:
```python
# –ë—ã–ª–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
country_id = int(form.get('country')) if form.get('country') else None
```

–ö–æ–¥ –æ–∂–∏–¥–∞–ª ID (—á–∏—Å–ª–æ), –∞ –ø–æ–ª—É—á–∞–ª –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã (—Å—Ç—Ä–æ–∫—É).

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —à–∞–±–ª–æ–Ω —Ñ–æ—Ä–º—ã

**–§–∞–π–ª:** `templates/admin/companies/form.html`

```html
<!-- –°—Ç–∞–ª–æ (–ü–†–ê–í–ò–õ–¨–ù–û): -->
<option value="{{ c.id }}" {% if company and company.country == c.name %}selected{% endif %}>{{ c.name }}</option>
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤:
```html
<option value="{{ city.id }}" {% if company and company.city == city.name %}selected{% endif %}>{{ city.name }}</option>
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏

**–§–∞–π–ª:** `main.py` - —Ñ—É–Ω–∫—Ü–∏—è `admin_edit_company_post()`

```python
# –ë—ã–ª–æ:
company.country = form.get('country')
company.city = form.get('city')

# –°—Ç–∞–ª–æ:
# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω—ã –∏ –≥–æ—Ä–æ–¥–∞ –ø–æ ID
country_id = int(form.get('country')) if form.get('country') else None
city_id = int(form.get('city')) if form.get('city') else None

if country_id:
    country = db.query(Country).get(country_id)
    company.country = country.name if country else ''
else:
    company.country = ''
    
if city_id:
    city = db.query(City).get(city_id)
    company.city = city.name if city else ''
else:
    company.city = ''
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### templates/admin/companies/form.html
- –ò–∑–º–µ–Ω–µ–Ω–æ `value="{{ c.name }}"` –Ω–∞ `value="{{ c.id }}"` –¥–ª—è —Å—Ç—Ä–∞–Ω
- –ò–∑–º–µ–Ω–µ–Ω–æ `value="{{ city.name }}"` –Ω–∞ `value="{{ city.id }}"` –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤

### main.py
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `Country, City` –≤ —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ID —Å—Ç—Ä–∞–Ω –∏ –≥–æ—Ä–æ–¥–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –≤ –ë–î

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ —Å –≤—ã–±–æ—Ä–æ–º —Å—Ç—Ä–∞–Ω—ã –∏ –≥–æ—Ä–æ–¥–∞
2. ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–º–ø–∞–Ω–∏–∏
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ñ–æ—Ä–º–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

## –°—Ç–∞—Ç—É—Å

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** - –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã –≤–º–µ—Å—Ç–æ ID —Ä–µ—à–µ–Ω–∞
üîÑ **–¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ —Å—Ç–µ–π–¥–∂–µ

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–æ—Ä–º—ã** - –≤–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ö
2. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é** - –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å ID –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ –ë–î
3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** - –¥–æ–±–∞–≤–∏—Ç—å try-catch –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö ID