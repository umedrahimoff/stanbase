{% extends 'layout.html' %}

{% block title %}{{ company.name }} — {{ company.industry }} компания в {{ company.city }}, {{ company.country }} | stanbase{% endblock %}

{% block meta_description %}{{ company.name }} - {{ company.industry }} компания на стадии {{ company.stage }} в {{ company.city }}, {{ company.country }}. {{ company.description[:150] }}{% if company.description|length > 150 %}...{% endif %}{% if company.founded_date %} Основана {{ company.founded_date.strftime('%d.%m.%Y') }}.{% endif %}{% if company.website %} Официальный сайт: {{ company.website }}{% endif %}{% endblock %}

{% block meta_keywords %}{{ company.name }}, {{ company.industry }}, {{ company.stage }}, {{ company.city }}, {{ company.country }}, компания, инновации, технологические проекты, Центральная Азия{% endblock %}

{% block og_title %}{{ company.name }} — {{ company.industry }} компания в {{ company.city }}, {{ company.country }} | stanbase{% endblock %}

{% block og_description %}{{ company.name }} - {{ company.industry }} компания на стадии {{ company.stage }} в {{ company.city }}, {{ company.country }}. {{ company.description[:150] }}{% if company.description|length > 150 %}...{% endif %}{% if company.founded_date %} Основана {{ company.founded_date.strftime('%d.%m.%Y') }}.{% endif %}{% if company.website %} Официальный сайт: {{ company.website }}{% endif %}{% endblock %}

{% block twitter_title %}{{ company.name }} — {{ company.industry }} компания в {{ company.city }}, {{ company.country }} | stanbase{% endblock %}

{% block twitter_description %}{{ company.name }} - {{ company.industry }} компания на стадии {{ company.stage }} в {{ company.city }}, {{ company.country }}. {{ company.description[:150] }}{% if company.description|length > 150 %}...{% endif %}{% endblock %}

{% block content %}
{% if not (session is defined and session.get('user_id')) %}
<div class="alert alert-warning d-flex justify-content-between align-items-center mb-4">
  <span>Для доступа к полной информации, пожалуйста, авторизуйтесь</span>
  <button type="button" class="btn btn-sm btn-outline-primary ms-3 open-login-modal">Войти</button>
</div>
{% endif %}
<div class="row mb-4">
  <div class="col-lg-8">
    <div class="card mb-4 shadow-sm">
      <div class="card-body d-flex align-items-center mb-2">
        {% if company.logo %}
          <img src="{{ company.logo }}" alt="logo" width="48" height="48" class="rounded-circle me-3" style="object-fit:cover;">
        {% else %}
          <img src="https://api.dicebear.com/7.x/identicon/svg?seed={{ company.name|urlencode }}" alt="logo" width="48" height="48" class="rounded-circle me-3" style="object-fit:cover;">
        {% endif %}
        <div>
          <h2 class="mb-1">{{ company.name }}</h2>
          <div class="mb-2 text-muted small">{{ company.country }}, {{ company.city }} | {{ company.stage }} | {{ company.industry }}</div>
        </div>
      </div>
      <div class="card-body pt-0">
        <div class="mb-3">{{ company.description|replace('\n', '<br>')|safe }}</div>
        <ul class="list-unstyled mb-3">
          {% if company.founded_date %}<li><b>Дата основания:</b> {{ company.founded_date.strftime('%d.%m.%Y') }}</li>{% endif %}
          {% if company.website %}<li><b>Сайт:</b> <a href="{{ company.website }}" target="_blank">{{ company.website }}</a></li>{% endif %}
        </ul>
        <hr class="my-4">
        <h5 class="mt-4 mb-2">Команда</h5>
        {% if team %}
          <ul class="list-group mb-4">
            {% for person in team %}
              <li class="list-group-item team-member-item">
                {% if session is defined and session.get('user_id') %}
                  <span><a href="#">{{ person.name }}</a> — {{ person.role }}</span>
                  <div class="social-icons-container">
                    {% if person.linkedin %}
                      <a href="{{ person.linkedin }}" target="_blank" class="social-icon social-icon-linkedin" title="LinkedIn">
                        <i class="bi bi-linkedin"></i>
                      </a>
                    {% endif %}
                    {% if person.telegram %}
                      <a href="{% if person.telegram.startswith('@') %}https://t.me/{{ person.telegram[1:] }}{% elif person.telegram.startswith('http') %}{{ person.telegram }}{% else %}https://t.me/{{ person.telegram }}{% endif %}" target="_blank" class="social-icon social-icon-telegram" title="Telegram">
                        <i class="bi bi-telegram"></i>
                      </a>
                    {% endif %}
                    {% if person.website %}
                      <a href="{{ person.website }}" target="_blank" class="social-icon social-icon-website" title="Веб-сайт">
                        <i class="bi bi-globe"></i>
                      </a>
                    {% endif %}
                    {% if person.instagram %}
                      <a href="{% if person.instagram.startswith('@') %}https://instagram.com/{{ person.instagram[1:] }}{% elif person.instagram.startswith('http') %}{{ person.instagram }}{% else %}https://instagram.com/{{ person.instagram }}{% endif %}" target="_blank" class="social-icon social-icon-instagram" title="Instagram">
                        <i class="bi bi-instagram"></i>
                      </a>
                    {% endif %}
                  </div>
                {% else %}
                  <span>{{ person.name[:2] }}****</span>
                  <div class="social-icons-container"></div>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted mb-4">Нет данных о команде.</div>
        {% endif %}
        <hr class="my-4">
        <h5 class="mt-4 mb-2">Инвестиционные раунды</h5>
        {% if deals %}
          <ul class="list-group mb-4">
            {% for deal in deals %}
              <li class="list-group-item">
                <b>{{ deal.type }}</b> — {% if session is defined and session.get('user_id') %}{{ "{:,}".format(deal.amount|int) }}{% else %}{{ (deal.amount|string)[:2] }}****{% endif %}
                <span class="text-muted small">({{ deal.date.strftime('%d.%m.%Y') if deal.date else '' }})</span><br>
                <span class="text-muted small">Оценка: {% if session is defined and session.get('user_id') %}{{ "{:,}".format(deal.valuation|int) if deal.valuation else '—' }}{% else %}{{ (deal.valuation|string)[:2] if deal.valuation else '--' }}****{% endif %}</span><br>
                <span class="text-muted small">Инвестор(ы):
                  {% set inv_names = deal.investors.split(',') if deal.investors else [] %}
                  {% for inv in inv_names %}
                    {% set inv_obj = investor_dict.get(inv.strip()) %}
                    {% if inv_obj %}
                      <a href="/investor/{{ inv_obj.id }}">{{ inv_obj.name }}</a>{% if not loop.last %}, {% endif %}
                    {% else %}
                      {{ inv.strip() }}{% if not loop.last %}, {% endif %}
                    {% endif %}
                  {% endfor %}
                </span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted mb-4">Нет данных о сделках.</div>
        {% endif %}
        
        {% if company.pitches and company.pitches|length > 0 %}
        <hr class="my-4">
        <h5 class="mt-4 mb-2">Питчи компании</h5>
        {% for pitch in company.pitches %}
          {% if pitch.status == 'active' %}
          <div class="card mb-3">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <i class="bi bi-file-pdf text-danger me-2" style="font-size: 1.5rem;"></i>
                <div>
                  <h6 class="mb-1">{{ pitch.name }}</h6>
                  {% if pitch.created_at %}
                  <small class="text-muted">Добавлен: {{ pitch.created_at.strftime('%d.%m.%Y') }}</small>
                  {% endif %}
                </div>
              </div>
              <a href="{{ pitch.url }}" target="_blank" class="btn btn-outline-primary">
                <i class="bi bi-box-arrow-up-right me-2"></i>Посмотреть питч
              </a>
            </div>
          </div>
          {% endif %}
        {% endfor %}
        {% endif %}
        
        <hr class="my-4">
        <h5 class="mt-4 mb-2">Вакансии</h5>
        {% if jobs %}
          <ul class="list-group mb-4">
            {% for job in jobs %}
              <li class="list-group-item">
                <a href="/job/{{ job.id }}">{{ job.title }}</a> — {{ job.city }} ({{ job.job_type }})<br>
                <span class="text-muted small">Контакт: {{ job.contact }}</span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted mb-4">Нет открытых вакансий.</div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="mb-3">Похожие компании</h5>
        {% if similar %}
          <ul class="list-group list-group-flush mb-4">
            {% for s in similar[:5] %}
              <li class="list-group-item d-flex align-items-center">
                {% if s.logo %}
                  <img src="{{ s.logo }}" alt="logo" width="32" height="32" class="rounded-circle me-2" style="object-fit:cover;">
                {% else %}
                  <img src="https://api.dicebear.com/7.x/identicon/svg?seed={{ s.name|urlencode }}" alt="logo" width="32" height="32" class="rounded-circle me-2" style="object-fit:cover;">
                {% endif %}
                <div>
                  <a href="/company/{{ s.id }}"><b>{{ s.name }}</b></a><br>
                  <span class="text-muted small">{{ s.country }}, {{ s.city }} | {{ s.industry }}</span>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted mb-4">Нет похожих компаний.</div>
        {% endif %}
      </div>
    </div>
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="mb-3">Вакансии</h5>
        {% if jobs %}
          <ul class="list-group list-group-flush mb-4">
            {% for job in jobs[:5] %}
              <li class="list-group-item d-flex align-items-center">
                {% if company.logo %}
                  <img src="{{ company.logo }}" alt="logo" width="32" height="32" class="rounded-circle me-2" style="object-fit:cover;">
                {% else %}
                  <img src="https://api.dicebear.com/7.x/identicon/svg?seed={{ company.name|urlencode }}" alt="logo" width="32" height="32" class="rounded-circle me-2" style="object-fit:cover;">
                {% endif %}
                <div>
                  <span><a href="/job/{{ job.id }}"><b>{{ job.title }}</b></a>, <span class="fw-bold">{{ company.name }}</span></span><br>
                  <span class="text-muted small">{{ job.city }}, {{ job.job_type }}</span>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted mb-4">Нет открытых вакансий.</div>
        {% endif %}
      </div>
    </div>
    
    {# Удалён блок технической информации #}
    
  </div>
</div>
{% endblock %}



{% block styles %}
{{ super() }}
<style>
.blurred {
  color: transparent;
  text-shadow: 0 0 8px #888;
  background: repeating-linear-gradient(90deg, #eee 0 10px, #fff 10px 20px);
  border-radius: 4px;
  padding: 0 8px;
  user-select: none;
}
.card { margin-bottom: 2rem; }
hr.my-4 { margin-top: 2rem; margin-bottom: 2rem; }
</style>
{% endblock %}

