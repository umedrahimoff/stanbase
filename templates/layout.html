<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Stanbase{% endblock %}</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block meta_description %}Stanbase - ведущая платформа для стартапов, венчурных и ангельских инвесторов Центральной Азии. Найдите инновационные проекты, инвесторов и актуальные новости экосистемы региона.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}стартапы, венчурные инвесторы, ангельские инвесторы, компании, Центральная Азия, венчурные инвестиции, инновации, технологические проекты, Казахстан, Узбекистан, Кыргызстан, Таджикистан, Туркменистан{% endblock %}">
    <meta name="author" content="Stanbase">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:site_name" content="Stanbase">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{% endblock %}">
    
    <!-- Additional Meta Tags -->
    <meta name="language" content="ru">
    <meta name="geo.region" content="KZ,UZ,KG,TJ,TM">
    <meta name="geo.placename" content="Центральная Азия">
    <link rel="canonical" href="{{ request.url }}">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', path='favicon.png') }}?v=2" />
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', path='favicon.png') }}?v=2" />
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', path='favicon.png') }}?v=2" />
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', path='favicon.png') }}?v=2" />
    <link rel="manifest" href="{{ url_for('static', path='site.webmanifest') }}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', path='social-icons.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', path='custom-colors.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', path='feedback.js') }}" defer></script>


    <style>
      body { background: #fff; font-family: 'Raleway', Arial, sans-serif; }
      .card { border-radius: 12px; }
      .navbar { margin-bottom: 2rem; }
      .card-title a, .card-body a {
        color: inherit !important;
        text-decoration: none !important;
      }
      .card-title a:hover, .card-body a:hover {
        color: inherit !important;
        text-decoration: none !important;
      }
      
      /* Принудительные стили для логотипа */
      .navbar .navbar-brand {
        color: #146AFF !important;
        font-weight: bold !important;
      }
      .navbar .navbar-brand:hover {
        color: #0d5ae6 !important;
      }
      .navbar-light .navbar-brand {
        color: #146AFF !important;
      }
      .navbar-light .navbar-brand:hover {
        color: #0d5ae6 !important;
      }
      
      /* Кнопка обратной связи */
      .feedback-button-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
      }
      
      .feedback-button {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
      }
      
      .feedback-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      }
      
      /* Адаптивность для мобильных устройств */
      @media (max-width: 767.98px) {
        .feedback-button {
          width: 50px;
          height: 50px;
          font-size: 1rem;
          bottom: 15px;
          right: 15px;
        }
      }
      

    </style>
    {% block head %}{% endblock %}
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
      <div class="container">
        <a class="navbar-brand fw-bold" href="/">stanbase</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mainNavbar">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="/companies">Компании</a></li>
            <li class="nav-item"><a class="nav-link" href="/investors">Инвесторы</a></li>
            <li class="nav-item"><a class="nav-link" href="/news">Новости</a></li>
            <li class="nav-item"><a class="nav-link" href="/events">Мероприятия</a></li>
            <!-- Кнопка Войти/Добавить запись -->
            {% if session is defined and session.get('user_id') %}
            <li class="nav-item dropdown d-flex align-items-center">
              <a href="#" class="nav-link dropdown-toggle d-flex align-items-center" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="https://api.dicebear.com/7.x/identicon/svg?seed={{ session.get('user_email', 'user') }}" alt="avatar" width="32" height="32" class="rounded-circle me-2"/>
                <span class="d-none d-md-inline">{{ session.get('user_name', 'Пользователь') }}</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                <li><a class="dropdown-item" href="/dashboard">
                  <i class="bi bi-person-circle me-2"></i>Личный кабинет
                </a></li>
                {% if session.get('role') in ['admin', 'moderator'] %}
                <li><a class="dropdown-item" href="/admin">
                  <i class="bi bi-gear me-2"></i>Админ панель
                </a></li>
                {% endif %}
                <li><a class="dropdown-item" href="/notifications">
                  <i class="bi bi-bell me-2"></i>Уведомления
                  <span class="badge bg-primary ms-2" id="nav-notifications-count">0</span>
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/logout">Выйти</a></li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item d-flex align-items-center">
              <button class="btn btn-outline-primary ms-lg-3" data-bs-toggle="modal" data-bs-target="#loginModal">Войти</button>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
    

    
    <div class="container">
      {% if session.get('flash') %}
        <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
          {{ session.get('flash') }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% set _ = session.pop('flash') %}
      {% endif %}
      {% block content %}{% endblock %}
      <div style="margin-bottom: 48px;"></div>
      
      <!-- Модальное окно обратной связи -->
      {% include "components/feedback_modal.html" %}
      
      <!-- Скрытые поля с данными пользователя для JavaScript -->
      {% if session is defined and session.get('user_id') %}
      <div id="userData" style="display: none;" 
           data-user-id="{{ session.get('user_id') }}"
           data-user-name="{{ session.get('user_name', '') }}"
           data-user-email="{{ session.get('user_email', '') }}"
           data-is-authenticated="true">
      </div>
      {% else %}
      <div id="userData" style="display: none;" 
           data-user-id=""
           data-user-name=""
           data-user-email=""
           data-is-authenticated="false">
      </div>
      {% endif %}
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="loginModalLabel">Вход</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="loginForm" method="post" action="/login">
              <div class="mb-3">
                <label for="login-email" class="form-label">Email</label>
                <input type="email" class="form-control" id="login-email" name="email" required autofocus>
              </div>
              <div class="mb-3">
                <label for="login-password" class="form-label">Пароль</label>
                <input type="password" class="form-control" id="login-password" name="password" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">Войти</button>
            </form>
            <div class="mt-3 text-center">
              <a href="/register" id="showRegisterPage" class="text-decoration-none">Нет аккаунта? Зарегистрироваться</a>
              <br>
              <a href="/forgot-password" class="text-muted small text-decoration-none">Забыли пароль?</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var showRegister = document.getElementById('showRegisterModal');
        var showLogin = document.getElementById('showLoginModal');
        if (showRegister) {
          showRegister.addEventListener('click', function(e) {
            e.preventDefault();
            var loginModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('loginModal'));
            var registerModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('registerModal'));
            loginModal.hide();
            setTimeout(function() { registerModal.show(); }, 300);
          });
        }
        if (showLogin) {
          showLogin.addEventListener('click', function(e) {
            e.preventDefault();
            var registerModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('registerModal'));
            var loginModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('loginModal'));
            registerModal.hide();
            setTimeout(function() { loginModal.show(); }, 300);
          });
        }

        // AJAX логин
        var loginForm = document.getElementById('loginForm');
        if (loginForm) {
          loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Отправка формы логина');
            var formData = new FormData(loginForm);
            var resp = await fetch('/login', {
              method: 'POST',
              body: formData,
              headers: { 'X-Requested-With': 'XMLHttpRequest' },
              credentials: 'same-origin'
            });
            var data = await resp.json();
            if (data.success) {
              window.location.reload();
            } else {
              var alert = loginForm.querySelector('.alert');
              if (!alert) {
                alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                loginForm.prepend(alert);
              }
              alert.textContent = data.error || 'Ошибка входа';
            }
          });
        }
        // AJAX регистрация
        var registerForm = document.getElementById('registerForm');
        if (registerForm) {
          registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Отправка формы регистрации');
            var formData = new FormData(registerForm);
            var resp = await fetch('/register', {
              method: 'POST',
              body: formData,
              headers: { 'X-Requested-With': 'XMLHttpRequest', 'Accept': 'application/json' },
              credentials: 'same-origin'
            });
            var data;
            try {
              data = await resp.json();
            } catch (err) {
              var alert = registerForm.querySelector('.alert');
              if (!alert) {
                alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                registerForm.prepend(alert);
              }
              alert.textContent = 'Ошибка регистрации: некорректный ответ сервера.';
              return;
            }
            if (data.success) {
              window.location.reload();
            } else {
              var alert = registerForm.querySelector('.alert');
              if (!alert) {
                alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                registerForm.prepend(alert);
              }
              alert.textContent = data.error || 'Ошибка регистрации';
            }
          });
        }
        // Открытие модалки логина по кнопке/ссылке с классом .open-login-modal
        document.querySelectorAll('.open-login-modal').forEach(function(btn) {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            var loginModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('loginModal'));
            loginModal.show();
          });
        });
      });
    </script>
    <footer class="footer mt-auto py-3 bg-light border-top">
      <div class="container">
        <div class="row">
          <div class="col-md-6 text-center text-md-start">
            <div class="small text-muted">
              Stanbase &copy; 2025 &middot; Powered by Venn Lab
            </div>
          </div>
          <div class="col-md-6 text-center text-md-end">
            <div class="small text-muted">
              <a href="/about" class="text-muted text-decoration-none me-3">О нас</a>
              <a href="/privacy" class="text-muted text-decoration-none me-3">Политика конфиденциальности</a>
              <a href="/terms" class="text-muted text-decoration-none me-3">Условия использования</a>
            </div>
          </div>
        </div>

      </div>
    </footer>
    
    <!-- Кнопка обратной связи (правый нижний угол) -->
    <div class="feedback-button-container">
      <button class="btn btn-primary feedback-button" id="feedbackButton" title="Обратная связь">
        <i class="bi bi-chat-dots"></i>
      </button>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {% block scripts %}{% endblock %}
  </body>
</html> 