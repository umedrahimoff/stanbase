<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Stanbase{% endblock %}</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block meta_description %}Stanbase - –≤–µ–¥—É—â–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π –∏ –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ê–∑–∏–∏. –ù–∞–π–¥–∏—Ç–µ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã, –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã —Ä–µ–≥–∏–æ–Ω–∞.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}–∫–æ–º–ø–∞–Ω–∏–∏, –∏–Ω–≤–µ—Å—Ç–æ—Ä—ã, –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ê–∑–∏—è, –≤–µ–Ω—á—É—Ä–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã, –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω, –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω, –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω, –¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω{% endblock %}">
    <meta name="author" content="Stanbase">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:site_name" content="Stanbase">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{% endblock %}">
    
    <!-- Additional Meta Tags -->
    <meta name="language" content="ru">
    <meta name="geo.region" content="KZ,UZ,KG,TJ,TM">
    <meta name="geo.placename" content="–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ê–∑–∏—è">
    <link rel="canonical" href="{{ request.url }}">
    <link rel="icon" type="image/svg+xml" href="https://api.dicebear.com/7.x/bottts/svg?seed=stanbase" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', path='social-icons.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', path='custom-colors.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', path='feedback.js') }}" defer></script>


    <style>
      body { background: #fff; font-family: 'Raleway', Arial, sans-serif; }
      .card { border-radius: 12px; }
      .navbar { margin-bottom: 2rem; }
      .card-title a, .card-body a {
        color: inherit !important;
        text-decoration: none !important;
      }
      .card-title a:hover, .card-body a:hover {
        color: inherit !important;
        text-decoration: none !important;
      }
    </style>
    {% block head %}{% endblock %}
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
      <div class="container">
        <a class="navbar-brand fw-bold" href="/">Stanbase</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="mainNavbar">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="/companies">–ö–æ–º–ø–∞–Ω–∏–∏</a></li>
            <li class="nav-item"><a class="nav-link" href="/investors">–ò–Ω–≤–µ—Å—Ç–æ—Ä—ã</a></li>
            <li class="nav-item"><a class="nav-link" href="/news">–ù–æ–≤–æ—Å—Ç–∏</a></li>
            <li class="nav-item"><a class="nav-link" href="/events">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a></li>
            <!-- –ö–Ω–æ–ø–∫–∞ –í–æ–π—Ç–∏/–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å -->
            {% if session is defined and session.get('user_id') %}
            <li class="nav-item dropdown d-flex align-items-center">
              <a href="#" class="nav-link dropdown-toggle d-flex align-items-center" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="https://api.dicebear.com/7.x/identicon/svg?seed={{ session.get('user_email', 'user') }}" alt="avatar" width="32" height="32" class="rounded-circle me-2"/>
                <span class="d-none d-md-inline">{{ session.get('user_name', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') }}</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                <li><a class="dropdown-item" href="/notifications">
                  <i class="bi bi-bell me-2"></i>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                  <span class="badge bg-primary ms-2" id="nav-notifications-count">0</span>
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/logout">–í—ã–π—Ç–∏</a></li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item d-flex align-items-center">
              <button class="btn btn-outline-primary ms-lg-3" data-bs-toggle="modal" data-bs-target="#loginModal">–í–æ–π—Ç–∏</button>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à–∞—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞) -->
    <div class="d-none d-lg-block">
      <div class="container">
        <div class="alert alert-info alert-dismissible fade show py-3 px-4" role="alert" style="border-radius: 8px; border: 1px solid #b6effb; background-color: #f0f9ff; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <span class="fw-medium">
                üí° –ù–∞—à–ª–∏ –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ? –ù–∞–∂–º–∏—Ç–µ <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>B</kbd> –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–º!
              </span>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="container">
      {% if session.get('flash') %}
        <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
          {{ session.get('flash') }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% set _ = session.pop('flash') %}
      {% endif %}
      {% block content %}{% endblock %}
      <div style="margin-bottom: 48px;"></div>
      
      <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ -->
      {% include "components/feedback_modal.html" %}
      
      <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è JavaScript -->
      {% if session is defined and session.get('user_id') %}
      <div id="userData" style="display: none;" 
           data-user-id="{{ session.get('user_id') }}"
           data-user-name="{{ session.get('user_name', '') }}"
           data-user-email="{{ session.get('user_email', '') }}"
           data-is-authenticated="true">
      </div>
      {% else %}
      <div id="userData" style="display: none;" 
           data-user-id=""
           data-user-name=""
           data-user-email=""
           data-is-authenticated="false">
      </div>
      {% endif %}
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="loginModalLabel">–í—Ö–æ–¥</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="loginForm" method="post" action="/login">
              <div class="mb-3">
                <label for="login-email" class="form-label">Email</label>
                <input type="email" class="form-control" id="login-email" name="email" required autofocus>
              </div>
              <div class="mb-3">
                <label for="login-password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" class="form-control" id="login-password" name="password" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">–í–æ–π—Ç–∏</button>
            </form>
            <div class="mt-3 text-center">
              <a href="/register" id="showRegisterPage">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var showRegister = document.getElementById('showRegisterModal');
        var showLogin = document.getElementById('showLoginModal');
        if (showRegister) {
          showRegister.addEventListener('click', function(e) {
            e.preventDefault();
            var loginModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('loginModal'));
            var registerModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('registerModal'));
            loginModal.hide();
            setTimeout(function() { registerModal.show(); }, 300);
          });
        }
        if (showLogin) {
          showLogin.addEventListener('click', function(e) {
            e.preventDefault();
            var registerModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('registerModal'));
            var loginModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('loginModal'));
            registerModal.hide();
            setTimeout(function() { loginModal.show(); }, 300);
          });
        }

        // AJAX –ª–æ–≥–∏–Ω
        var loginForm = document.getElementById('loginForm');
        if (loginForm) {
          loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ª–æ–≥–∏–Ω–∞');
            var formData = new FormData(loginForm);
            var resp = await fetch('/login', {
              method: 'POST',
              body: formData,
              headers: { 'X-Requested-With': 'XMLHttpRequest' },
              credentials: 'same-origin'
            });
            var data = await resp.json();
            if (data.success) {
              window.location.reload();
            } else {
              var alert = loginForm.querySelector('.alert');
              if (!alert) {
                alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                loginForm.prepend(alert);
              }
              alert.textContent = data.error || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
            }
          });
        }
        // AJAX —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        var registerForm = document.getElementById('registerForm');
        if (registerForm) {
          registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
            var formData = new FormData(registerForm);
            var resp = await fetch('/register', {
              method: 'POST',
              body: formData,
              headers: { 'X-Requested-With': 'XMLHttpRequest', 'Accept': 'application/json' },
              credentials: 'same-origin'
            });
            var data;
            try {
              data = await resp.json();
            } catch (err) {
              var alert = registerForm.querySelector('.alert');
              if (!alert) {
                alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                registerForm.prepend(alert);
              }
              alert.textContent = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞.';
              return;
            }
            if (data.success) {
              window.location.reload();
            } else {
              var alert = registerForm.querySelector('.alert');
              if (!alert) {
                alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                registerForm.prepend(alert);
              }
              alert.textContent = data.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
            }
          });
        }
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ª–æ–≥–∏–Ω–∞ –ø–æ –∫–Ω–æ–ø–∫–µ/—Å—Å—ã–ª–∫–µ —Å –∫–ª–∞—Å—Å–æ–º .open-login-modal
        document.querySelectorAll('.open-login-modal').forEach(function(btn) {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            var loginModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('loginModal'));
            loginModal.show();
          });
        });
      });
    </script>
    <footer class="footer mt-auto py-3 bg-light border-top">
      <div class="container">
        <div class="row">
          <div class="col-md-6 text-center text-md-start">
            <div class="small text-muted">
              Stanbase &copy; 2025 &middot; Powered by Venn Lab
            </div>
          </div>
          <div class="col-md-6 text-center text-md-end">
            <div class="small text-muted">
              <a href="/privacy" class="text-muted text-decoration-none me-3">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
              <a href="/terms" class="text-muted text-decoration-none me-3">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
            </div>
          </div>
        </div>
        <div class="row mt-2">
          <div class="col-12 text-center">
            <div class="small text-muted">
              <i class="bi bi-bug"></i> –ù–∞—à–ª–∏ –æ—à–∏–±–∫—É? –ù–∞–∂–º–∏—Ç–µ <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>B</kbd> –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
            </div>
          </div>
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {% block scripts %}{% endblock %}
  </body>
</html> 