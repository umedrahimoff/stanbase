{% extends "admin/layout.html" %}

{% block title %}–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å #{{ feedback.id }} - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å #{{ feedback.id }}</h1>
    <div class="d-flex gap-2">
      <a href="{{ url_for('admin_feedback') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
      </a>
    </div>
  </div>

  <div class="row">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="col-lg-8">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">–î–µ—Ç–∞–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏</h5>
        </div>
        <div class="card-body">
          <!-- –¢–∏–ø –∏ —Å—Ç–∞—Ç—É—Å -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">–¢–∏–ø:</label>
              <div>
                {% if feedback.type == 'bug' %}
                  <span class="badge bg-danger fs-6">üêõ –û—à–∏–±–∫–∞/–ë–∞–≥</span>
                {% elif feedback.type == 'feature' %}
                  <span class="badge bg-primary fs-6">üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏</span>
                {% elif feedback.type == 'improvement' %}
                  <span class="badge bg-warning fs-6">‚ö° –£–ª—É—á—à–µ–Ω–∏–µ</span>
                {% else %}
                  <span class="badge bg-secondary fs-6">üìù –î—Ä—É–≥–æ–µ</span>
                {% endif %}
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">–°—Ç–∞—Ç—É—Å:</label>
              <div>
                {% if feedback.status == 'new' %}
                  <span class="badge bg-warning fs-6">–ù–æ–≤—ã–π</span>
                {% elif feedback.status == 'in_progress' %}
                  <span class="badge bg-info fs-6">–í —Ä–∞–±–æ—Ç–µ</span>
                {% elif feedback.status == 'resolved' %}
                  <span class="badge bg-success fs-6">–†–µ—à–µ–Ω–æ</span>
                {% elif feedback.status == 'closed' %}
                  <span class="badge bg-secondary fs-6">–ó–∞–∫—Ä—ã—Ç–æ</span>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
          <div class="mb-3">
            <label class="form-label fw-bold">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:</label>
            <div class="border rounded p-3 bg-light">
              {{ feedback.description | nl2br }}
            </div>
          </div>

          <!-- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ -->
          {% if feedback.suggestion %}
          <div class="mb-3">
            <label class="form-label fw-bold">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
            <div class="border rounded p-3 bg-light">
              {{ feedback.suggestion | nl2br }}
            </div>
          </div>
          {% endif %}

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">–ò–º—è:</label>
              <div>{{ feedback.name or '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">Email:</label>
              <div>
                {% if feedback.email %}
                  <a href="mailto:{{ feedback.email }}">{{ feedback.email }}</a>
                {% else %}
                  –ù–µ —É–∫–∞–∑–∞–Ω
                {% endif %}
              </div>
            </div>
          </div>

          <!-- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div class="mb-3">
            <label class="form-label fw-bold">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</label>
            <div class="row">
              <div class="col-md-6">
                <small class="text-muted">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:</small>
                <div>
                  {% if feedback.is_authenticated %}
                    <span class="badge bg-success">–î–∞</span>
                  {% else %}
                    <span class="badge bg-secondary">–ù–µ—Ç</span>
                  {% endif %}
                </div>
              </div>
              <div class="col-md-6">
                <small class="text-muted">–†–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞:</small>
                <div>{{ feedback.screen_size or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</div>
              </div>
            </div>
          </div>

          <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ -->
          {% if feedback.page_url %}
          <div class="mb-3">
            <label class="form-label fw-bold">–°—Ç—Ä–∞–Ω–∏—Ü–∞:</label>
            <div>
              <a href="{{ feedback.page_url }}" target="_blank">{{ feedback.page_title or feedback.page_url }}</a>
            </div>
            <small class="text-muted">{{ feedback.page_url }}</small>
          </div>
          {% endif %}

          <!-- User Agent -->
          {% if feedback.user_agent %}
          <div class="mb-3">
            <label class="form-label fw-bold">User Agent:</label>
            <div class="border rounded p-2 bg-light">
              <small>{{ feedback.user_agent }}</small>
            </div>
          </div>
          {% endif %}

          <!-- –î–∞—Ç—ã -->
          <div class="row">
            <div class="col-md-6">
              <label class="form-label fw-bold">–°–æ–∑–¥–∞–Ω–æ:</label>
              <div>{{ feedback.created_at.strftime('%d.%m.%Y %H:%M:%S') }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">–û–±–Ω–æ–≤–ª–µ–Ω–æ:</label>
              <div>{{ feedback.updated_at.strftime('%d.%m.%Y %H:%M:%S') }}</div>
            </div>
          </div>

          {% if feedback.processed_by %}
          <div class="row mt-3">
            <div class="col-md-6">
              <label class="form-label fw-bold">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ:</label>
              <div>{{ feedback.processed_by }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">–î–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
              <div>{{ feedback.processed_at.strftime('%d.%m.%Y %H:%M:%S') if feedback.processed_at else '–ù–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ' }}</div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="col-lg-4">
      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º</h5>
        </div>
        <div class="card-body">
          <form method="post" action="{{ url_for('admin_feedback_status', feedback_id=feedback.id) }}">
            <div class="mb-3">
              <label for="status" class="form-label">–°—Ç–∞—Ç—É—Å:</label>
              <select class="form-select" id="status" name="status" required>
                <option value="new" {% if feedback.status == 'new' %}selected{% endif %}>–ù–æ–≤—ã–π</option>
                <option value="in_progress" {% if feedback.status == 'in_progress' %}selected{% endif %}>–í —Ä–∞–±–æ—Ç–µ</option>
                <option value="resolved" {% if feedback.status == 'resolved' %}selected{% endif %}>–†–µ—à–µ–Ω–æ</option>
                <option value="closed" {% if feedback.status == 'closed' %}selected{% endif %}>–ó–∞–∫—Ä—ã—Ç–æ</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="admin_notes" class="form-label">–ó–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</label>
              <textarea class="form-control" id="admin_notes" name="admin_notes" rows="4" placeholder="–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ...">{{ feedback.admin_notes or '' }}</textarea>
            </div>
            <button type="submit" class="btn btn-primary w-100">
              <i class="bi bi-save"></i> –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
            </button>
          </form>
        </div>
      </div>

      <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            {% if feedback.email %}
            <a href="mailto:{{ feedback.email }}?subject=Re: –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å #{{ feedback.id }}" class="btn btn-outline-primary">
              <i class="bi bi-envelope"></i> –û—Ç–≤–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            </a>
            {% endif %}
            
            <a href="{{ feedback.page_url }}" target="_blank" class="btn btn-outline-info">
              <i class="bi bi-box-arrow-up-right"></i> –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
            </a>
            
            <form method="post" action="{{ url_for('admin_feedback_delete', feedback_id=feedback.id) }}" class="d-grid" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å?')">
              <button type="submit" class="btn btn-outline-danger">
                <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <div class="border-end">
                <h4 class="mb-0">{{ feedback.id }}</h4>
                <small class="text-muted">ID</small>
              </div>
            </div>
            <div class="col-6">
              <h4 class="mb-0">{{ feedback.created_at.strftime('%d.%m') }}</h4>
              <small class="text-muted">–î–∞—Ç–∞</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 