{% extends "admin/layout.html" %}

{% block title %}–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</h1>
    <div class="d-flex gap-2">
      <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
      </a>
    </div>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="get" class="row g-3">
        <div class="col-md-4">
          <label for="q" class="form-label">–ü–æ–∏—Å–∫</label>
          <input type="text" class="form-control" id="q" name="q" value="{{ q }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é, –∏–º–µ–Ω–∏, email...">
        </div>
        <div class="col-md-3">
          <label for="status" class="form-label">–°—Ç–∞—Ç—É—Å</label>
          <select class="form-select" id="status" name="status">
            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="new" {% if status == 'new' %}selected{% endif %}>–ù–æ–≤—ã–µ</option>
            <option value="in_progress" {% if status == 'in_progress' %}selected{% endif %}>–í —Ä–∞–±–æ—Ç–µ</option>
            <option value="resolved" {% if status == 'resolved' %}selected{% endif %}>–†–µ—à–µ–Ω–æ</option>
            <option value="closed" {% if status == 'closed' %}selected{% endif %}>–ó–∞–∫—Ä—ã—Ç–æ</option>
          </select>
        </div>
        <div class="col-md-2">
          <label for="per_page" class="form-label">–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</label>
          <select class="form-select" id="per_page" name="per_page">
            <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
            <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
            <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
          </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button type="submit" class="btn btn-primary me-2">
            <i class="bi bi-search"></i> –ü–æ–∏—Å–∫
          </button>
          <a href="{{ url_for('admin_feedback') }}" class="btn btn-outline-secondary">
            <i class="bi bi-x-circle"></i> –°–±—Ä–æ—Å
          </a>
        </div>
      </form>
    </div>
  </div>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">–í—Å–µ–≥–æ</h6>
              <h4 class="mb-0">{{ total }}</h4>
            </div>
            <div class="align-self-center">
              <i class="bi bi-chat-dots fs-1"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">–ù–æ–≤—ã–µ</h6>
              <h4 class="mb-0">{{ feedback_list | selectattr('status', 'equalto', 'new') | list | length }}</h4>
            </div>
            <div class="align-self-center">
              <i class="bi bi-exclamation-circle fs-1"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">–í —Ä–∞–±–æ—Ç–µ</h6>
              <h4 class="mb-0">{{ feedback_list | selectattr('status', 'equalto', 'in_progress') | list | length }}</h4>
            </div>
            <div class="align-self-center">
              <i class="bi bi-gear fs-1"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h6 class="card-title">–†–µ—à–µ–Ω–æ</h6>
              <h4 class="mb-0">{{ feedback_list | selectattr('status', 'equalto', 'resolved') | list | length }}</h4>
            </div>
            <div class="align-self-center">
              <i class="bi bi-check-circle fs-1"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ -->
  <div class="card">
    <div class="card-body">
      {% if feedback_list %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>–¢–∏–ø</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–∞—Ç–∞</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody>
              {% for feedback in feedback_list %}
              <tr>
                <td>{{ feedback.id }}</td>
                <td>
                  {% if feedback.type == 'bug' %}
                    <span class="badge bg-danger">üêõ –û—à–∏–±–∫–∞</span>
                  {% elif feedback.type == 'feature' %}
                    <span class="badge bg-primary">üí° –§—É–Ω–∫—Ü–∏—è</span>
                  {% elif feedback.type == 'improvement' %}
                    <span class="badge bg-warning">‚ö° –£–ª—É—á—à–µ–Ω–∏–µ</span>
                  {% else %}
                    <span class="badge bg-secondary">üìù –î—Ä—É–≥–æ–µ</span>
                  {% endif %}
                </td>
                <td>
                  <div class="text-truncate" style="max-width: 300px;" title="{{ feedback.description }}">
                    {{ feedback.description }}
                  </div>
                </td>
                <td>
                  {% if feedback.name %}
                    <div>{{ feedback.name }}</div>
                    {% if feedback.email %}
                      <small class="text-muted">{{ feedback.email }}</small>
                    {% endif %}
                  {% else %}
                    <span class="text-muted">–ê–Ω–æ–Ω–∏–º–Ω–æ</span>
                  {% endif %}
                  {% if feedback.is_authenticated %}
                    <span class="badge bg-success">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</span>
                  {% endif %}
                </td>
                <td>
                  {% if feedback.status == 'new' %}
                    <span class="badge bg-warning">–ù–æ–≤—ã–π</span>
                  {% elif feedback.status == 'in_progress' %}
                    <span class="badge bg-info">–í —Ä–∞–±–æ—Ç–µ</span>
                  {% elif feedback.status == 'resolved' %}
                    <span class="badge bg-success">–†–µ—à–µ–Ω–æ</span>
                  {% elif feedback.status == 'closed' %}
                    <span class="badge bg-secondary">–ó–∞–∫—Ä—ã—Ç–æ</span>
                  {% endif %}
                </td>
                <td>
                  <div>{{ feedback.created_at.strftime('%d.%m.%Y') }}</div>
                  <small class="text-muted">{{ feedback.created_at.strftime('%H:%M') }}</small>
                </td>
                <td>
                  <div class="btn-group" role="group">
                    <a href="{{ url_for('admin_feedback_detail', feedback_id=feedback.id) }}" class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-eye"></i>
                    </a>
                    <form method="post" action="{{ url_for('admin_feedback_delete', feedback_id=feedback.id) }}" class="d-inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å?')">
                      <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if total_pages > 1 %}
        <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
          <ul class="pagination justify-content-center">
            {% if page > 1 %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('admin_feedback', page=page-1, q=q, status=status, per_page=per_page) }}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
              </li>
            {% endif %}
            
            {% for p in range(1, total_pages + 1) %}
              {% if p == page %}
                <li class="page-item active">
                  <span class="page-link">{{ p }}</span>
                </li>
              {% elif p <= 3 or p > total_pages - 3 or (p >= page - 1 and p <= page + 1) %}
                <li class="page-item">
                  <a class="page-link" href="{{ url_for('admin_feedback', page=p, q=q, status=status, per_page=per_page) }}">{{ p }}</a>
                </li>
              {% elif p == 4 and page > 5 %}
                <li class="page-item disabled">
                  <span class="page-link">...</span>
                </li>
              {% elif p == total_pages - 3 and page < total_pages - 4 %}
                <li class="page-item disabled">
                  <span class="page-link">...</span>
                </li>
              {% endif %}
            {% endfor %}
            
            {% if page < total_pages %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('admin_feedback', page=page+1, q=q, status=status, per_page=per_page) }}">–°–ª–µ–¥—É—é—â–∞—è</a>
              </li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}
      {% else %}
        <div class="text-center py-5">
          <i class="bi bi-chat-dots fs-1 text-muted"></i>
          <h5 class="mt-3">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h5>
          <p class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %} 